<script>
  // ---------------- FIREBASE INIT ----------------
  firebase.initializeApp({
    apiKey: "AIzaSyBPOzL5ZoYd0NelkDNYk0LGBPDYVT2Tqew",
    authDomain: "connect-astro-e5309.firebaseapp.com",
    projectId: "connect-astro-e5309",
  });

  // ---------------- STATE ----------------
  let sessionId = null;
  const customerId = "cust_test_1";
  const astrologerId = "Gautam";

  // ---------------- START CHAT ----------------
  async function startChat() {
    try {
      console.log("START CHAT CLICKED");

      const functions = firebase.functions("asia-south1");
      const chatNow = functions.httpsCallable("chatNow");

      const res = await chatNow({
        customerId,
        astrologerId,
      });

      console.log(res.data);

      if (res.data.sessionId) {
        sessionId = res.data.sessionId;
        alert("Chat started");
      } else {
        alert(res.data.message);
      }
    } catch (e) {
      console.error(e);
      alert(e.message);
    }
  }

  // ---------------- SEND MESSAGE ----------------
  async function sendMessage() {
    if (!sessionId) {
      alert("Start chat first");
      return;
    }

    const input = document.getElementById("msg");
    const text = input.value.trim();
    if (!text) return;

    input.value = "";
    chatBox.innerHTML += `<div class="msg">${text}</div>`;

    const functions = firebase.functions("asia-south1");
    const sendMessageFn = functions.httpsCallable("sendMessage");

    await sendMessageFn({
      sessionId,
      senderId: customerId,
      text,
    });
  }
</script>



