<!doctype html>
<html>
  <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat with Astrologer Gautam</title>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.0.min.js"></script>

<style>
body{margin:0;font-family:Inter,system-ui;background:#ece5dd;display:flex;justify-content:center;height:100vh}
.chat{width:100%;max-width:420px;background:#fff;display:flex;flex-direction:column}
.header{background:#9b2c33;color:#fff;padding:12px;display:flex;align-items:center;gap:10px}
.avatar{width:42px;height:42px;border-radius:50%;background:#fff}
.messages{flex:1;padding:14px;overflow:auto;display:flex;flex-direction:column;gap:8px}
.bubble{max-width:75%;padding:10px 12px;border-radius:12px}
.me{align-self:flex-end;background:#dcf8c6}
.them{align-self:flex-start;background:#fff}
.composer{display:flex;gap:8px;padding:10px;border-top:1px solid #eee}
input{flex:1;padding:10px;border-radius:999px;border:1px solid #ddd}
button{padding:10px 16px;border-radius:999px;border:none;background:#f8cfa7;font-weight:600}
</style>
</head>

<body>
<div class="chat">

<div class="header">
  <img class="avatar" src="https://via.placeholder.com/150">
  <div><b>Astrologer Gautam</b></div>
</div>

<div id="messages" class="messages"></div>

<div class="composer">
  <input id="text" placeholder="Type a message...">
  <button onclick="send()">Send</button>
</div>

</div>

<script>
/* CONFIG */
const ASTRO = "Gautam";
const CUSTOMER_ID = "cust_" + Math.random().toString(36).slice(2,8);
const SESSION = `astro_${ASTRO}_${CUSTOMER_ID}`;

const pubnub = new PubNub({
  publishKey: "pub-c-a90a128a-4e77-4b6a-bbb3-59d0fb688ddc",
  subscribeKey: "sub-c-1b514e35-fab1-4baf-88f1-6b628ab7e9c2",
  uuid: CUSTOMER_ID
});

/* subscribe */
pubnub.subscribe({ channels:[SESSION] });

/* announce join */
pubnub.publish({
  channel:`astro_${ASTRO}_control`,
  message:{
    type:"join",
    astro:ASTRO,
    session:SESSION,
    customer:CUSTOMER_ID
  }
});

/* receive */
pubnub.addListener({
  message:e=>{
    const m=e.message;
    if(!m || !m.text) return;
    add(m.text, m.sender===CUSTOMER_ID ? "me":"them");
  }
});

function send(){
  const t=text.value.trim();
  if(!t) return;
  pubnub.publish({
    channel:SESSION,
    message:{ text:t, sender:CUSTOMER_ID }
  });
  text.value="";
}

function add(t,cls){
  const d=document.createElement("div");
  d.className="bubble "+cls;
  d.textContent=t;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
}
</script>
</body>
</html>

