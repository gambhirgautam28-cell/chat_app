<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat with Astrologer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f6f2ec;height:100vh;display:flex;flex-direction:column}
.header{background:#F8CFAF;padding:14px;display:flex;justify-content:space-between}
.chat{flex:1;padding:12px;overflow:auto}
.msg{padding:10px 12px;border-radius:12px;margin-bottom:8px;max-width:75%}
.me{background:#ffe0cc;margin-left:auto}
.them{background:#fff}
.controls{display:flex;gap:8px;padding:10px}
input{flex:1;padding:10px;border-radius:20px;border:1px solid #ccc}
button{padding:10px 16px;border-radius:20px;border:none;background:#F8CFAF;font-weight:700}
</style>
</head>

<body>

<div class="header">
  <strong>Astrologer Gautam</strong>
  ⏱️ <span id="timer">--:--</span>
</div>

<div id="chat" class="chat"></div>

<div class="controls">
  <input id="msg" placeholder="Type message…" />
  <button onclick="send()">Send</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBPOzL5ZoYd0NelkDNYk0LGBPDYVT2Tqew",
  authDomain: "connect-astro-e5309.firebaseapp.com",
  projectId: "connect-astro-e5309"
};

firebase.initializeApp(firebaseConfig);
const functions = firebase.functions();

const customerId = "cust_demo";
const astrologerId = "Gautam";
let sessionId = null;

// START CHAT
async function startChat() {
  const res = await functions.httpsCallable("chatNow")({
    customerId,
    astrologerId
  });
  sessionId = res.data.sessionId;
}

// SEND MESSAGE
async function send() {
  const text = msg.value.trim();
  if (!text || !sessionId) return;
  msg.value = "";
  add(text, "me");

  await functions.httpsCallable("sendMessage")({
    sessionId,
    senderId: customerId,
    text
  });
}

function add(text, cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

// AUTO START (for testing)
startChat();
</script>

</body>
</html>








