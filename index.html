<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Astro Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase COMPAT SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui;
      background: #f6f2ec;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: #8b1d2c;
      color: #fff;
      padding: 14px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #fff;
    }
    .start { padding: 12px; background: #fff; }
    .chat { flex: 1; padding: 14px; overflow-y: auto; }
    .msg {
      background: #ffe6d5;
      padding: 10px 12px;
      border-radius: 12px;
      margin-bottom: 8px;
      max-width: 70%;
      margin-left: auto;
    }
    .controls {
      padding: 12px;
      background: #fff;
      display: flex;
      gap: 8px;
      border-top: 1px solid #ddd;
    }
    input { flex: 1; padding: 10px; border-radius: 20px; }
    button {
      padding: 10px 16px;
      border-radius: 20px;
      border: none;
      background: #f8cfa7;
      font-weight: 700;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="header">
  <div class="avatar"></div>
  <div>
    <strong>Astrologer Gautam</strong><br>
    <small>Online</small>
  </div>
</div>

<div class="start">
  <button onclick="startChat()">Start Chat</button>
</div>

<div id="chatBox" class="chat">
  <p>Chat will appear here.</p>
</div>

<div class="controls">
  <input id="msgInput" placeholder="Type a message…" />
  <button onclick="sendMessage()">Send</button>
</div>

<script>
/* ---------- FIREBASE INIT ---------- */
firebase.initializeApp({
  apiKey: "AIzaSyBPOzL5ZoYd0NelkDNYk0LGBPDYVT2Tqew",
  authDomain: "connect-astro-e5309.firebaseapp.com",
  projectId: "connect-astro-e5309"
});

/* ---------- STATE ---------- */
const CUSTOMER_ID = "cust_test_1";
const ASTROLOGER_ID = "Gautam";
let sessionId = null;

/* ---------- START CHAT ---------- */
async function startChat() {
  try {
    console.log("Starting chat…");

    const functions = firebase.app().functions("asia-south1"); // ✅ FIX
    const chatNow = functions.httpsCallable("chatNow");

    const res = await chatNow({
      customerId: CUSTOMER_ID,
      astrologerId: ASTROLOGER_ID
    });

    console.log("SUCCESS:", res.data);

    sessionId = res.data.sessionId;
    alert("Chat started successfully");

  } catch (err) {
    console.error("ERROR:", err);
    alert(err.message);
  }
}

/* ---------- SEND MESSAGE (UI ONLY) ---------- */
function sendMessage() {
  if (!sessionId) {
    alert("Start chat first");
    return;
  }
  const input = document.getElementById("msgInput");
  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  const div = document.createElement("div");
  div.className = "msg";
  div.textContent = text;
  document.getElementById("chatBox").appendChild(div);
}
</script>

</body>
</html>





